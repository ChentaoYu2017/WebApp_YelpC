{"filter":false,"title":"secret.ejs","tooltip":"/Authentication/AuthDemo/views/secret.ejs","undoManager":{"mark":5,"position":5,"stack":[[{"start":{"row":0,"column":0},"end":{"row":85,"column":2},"action":"insert","lines":["var express               = require(\"express\"),","    mongoose              = require(\"mongoose\"),","    passport              = require(\"passport\"),","    bodyParser            = require(\"body-parser\"),","    User                  = require(\"./models/user\"),","    LocalStrategy         = require(\"passport-local\"),","    passportLocalMongoose = require(\"passport-local-mongoose\")","    ","mongoose.connect(\"mongodb://localhost/auth_demo_app\");","var app = express();","app.set('view engine', 'ejs');","app.use(bodyParser.urlencoded({extended: true}));","app.use(require(\"express-session\")({","    secret: \"Rusty is the best and cutest dog in the world\",","    resave: false,","    saveUninitialized: false","}));","","app.use(passport.initialize());","app.use(passport.session());","","passport.use(new LocalStrategy(User.authenticate()));","passport.serializeUser(User.serializeUser());","passport.deserializeUser(User.deserializeUser());","","//============","// ROUTES","//============","","app.get(\"/\", function(req, res){","    res.render(\"home\");","});","","app.get(\"/secret\",isLoggedIn, function(req, res){","   res.render(\"secret\"); ","});","","// Auth Routes","","//show sign up form","app.get(\"/register\", function(req, res){","   res.render(\"register\"); ","});","//handling user sign up","app.post(\"/register\", function(req, res){","    User.register(new User({username: req.body.username}), req.body.password, function(err, user){","        if(err){","            console.log(err);","            return res.render('register');","        }","        passport.authenticate(\"local\")(req, res, function(){","           res.redirect(\"/secret\");","        });","    });","});","","// LOGIN ROUTES","//render login form","app.get(\"/login\", function(req, res){","   res.render(\"login\"); ","});","//login logic","//middleware","app.post(\"/login\", passport.authenticate(\"local\", {","    successRedirect: \"/secret\",","    failureRedirect: \"/login\"","}) ,function(req, res){","});","","app.get(\"/logout\", function(req, res){","    req.logout();","    res.redirect(\"/\");","});","","","function isLoggedIn(req, res, next){","    if(req.isAuthenticated()){","        return next();","    }","    res.redirect(\"/login\");","}","","","app.listen(process.env.PORT, process.env.IP, function(){","    console.log(\"server started.......\");","})"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":85,"column":2},"action":"remove","lines":["var express               = require(\"express\"),","    mongoose              = require(\"mongoose\"),","    passport              = require(\"passport\"),","    bodyParser            = require(\"body-parser\"),","    User                  = require(\"./models/user\"),","    LocalStrategy         = require(\"passport-local\"),","    passportLocalMongoose = require(\"passport-local-mongoose\")","    ","mongoose.connect(\"mongodb://localhost/auth_demo_app\");","var app = express();","app.set('view engine', 'ejs');","app.use(bodyParser.urlencoded({extended: true}));","app.use(require(\"express-session\")({","    secret: \"Rusty is the best and cutest dog in the world\",","    resave: false,","    saveUninitialized: false","}));","","app.use(passport.initialize());","app.use(passport.session());","","passport.use(new LocalStrategy(User.authenticate()));","passport.serializeUser(User.serializeUser());","passport.deserializeUser(User.deserializeUser());","","//============","// ROUTES","//============","","app.get(\"/\", function(req, res){","    res.render(\"home\");","});","","app.get(\"/secret\",isLoggedIn, function(req, res){","   res.render(\"secret\"); ","});","","// Auth Routes","","//show sign up form","app.get(\"/register\", function(req, res){","   res.render(\"register\"); ","});","//handling user sign up","app.post(\"/register\", function(req, res){","    User.register(new User({username: req.body.username}), req.body.password, function(err, user){","        if(err){","            console.log(err);","            return res.render('register');","        }","        passport.authenticate(\"local\")(req, res, function(){","           res.redirect(\"/secret\");","        });","    });","});","","// LOGIN ROUTES","//render login form","app.get(\"/login\", function(req, res){","   res.render(\"login\"); ","});","//login logic","//middleware","app.post(\"/login\", passport.authenticate(\"local\", {","    successRedirect: \"/secret\",","    failureRedirect: \"/login\"","}) ,function(req, res){","});","","app.get(\"/logout\", function(req, res){","    req.logout();","    res.redirect(\"/\");","});","","","function isLoggedIn(req, res, next){","    if(req.isAuthenticated()){","        return next();","    }","    res.redirect(\"/login\");","}","","","app.listen(process.env.PORT, process.env.IP, function(){","    console.log(\"server started.......\");","})"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":8,"column":38},"action":"insert","lines":["<h1>This is the secret page!</h1>","","<p>You found me!</p>","","<img src=\"https://scontent-sjc2-1.xx.fbcdn.net/hphotos-xaf1/v/t1.0-9/197592_1007017930183_5279_n.jpg?oh=2e24b7a0b113730421ec4fc65ddad724&oe=568A3492\">","","<li><a href=\"/register\">Sign Up!</a></li>","<li><a href=\"/login\">Login!</a></li>","<li><a href=\"/logout\">Logout!</a></li>"],"id":3}],[{"start":{"row":4,"column":0},"end":{"row":4,"column":150},"action":"remove","lines":["<img src=\"https://scontent-sjc2-1.xx.fbcdn.net/hphotos-xaf1/v/t1.0-9/197592_1007017930183_5279_n.jpg?oh=2e24b7a0b113730421ec4fc65ddad724&oe=568A3492\">"],"id":4}],[{"start":{"row":3,"column":0},"end":{"row":4,"column":0},"action":"remove","lines":["",""],"id":5}],[{"start":{"row":2,"column":20},"end":{"row":3,"column":0},"action":"remove","lines":["",""],"id":6}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":6,"column":38},"end":{"row":6,"column":38},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1519068367042,"hash":"2107a07f2887e0eb27c1de4c0054a0783d9877af"}